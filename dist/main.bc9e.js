(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{20:function(e,t,n){},47:function(e,t,n){"use strict";n.r(t);n(20);var a=n(0),r=n.n(a),i=n(18),o=n.n(i),l=n(4),c=n.n(l),u=n(49),s=n(50),f=n(52),p=n(51),h=function(){c.a.initializeApp({apiKey:"AIzaSyAZWmB1nTjQVnSIaFylL3TICAnY_l7DRXM",authDomain:"be-my-friend.firebaseapp.com",databaseURL:"https://be-my-friend.firebaseio.com",projectId:"be-my-friend",storageBucket:"be-my-friend.appspot.com",messagingSenderId:"981772721378"})},m=function(e,t){return c.a.database().ref("users").orderByChild("email").equalTo(e).on("value",t)},d=function(e,t){c.a.database().ref("users/"+e).set(t)},v=function(e){return function(t){var n=c.a.database().ref().child(e).push().key;return c.a.database().ref(e+"/"+n).set(t),n}}("users"),b=function(e){return function(t){return console.log("in getFiedl"),c.a.database().ref(e).on("value",t)}},y=(b("email"),b("users")),g=b("article"),E=function(e){return c.a.database().ref(e).once("value")},k=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var w=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={value:"",userKey:""},n.handleChange=n.handleChange.bind(n),n.clearinput=n.clearinput.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.a.Component),k(t,[{key:"clearinput",value:function(){this.setState({value:""})}},{key:"handleChange",value:function(e){var t=this;this.setState({value:e.currentTarget.value}),m(e.currentTarget.value,function(e){var n=!1;e.forEach(function(a){if(a.key)return console.log("xxxxxxxxxxxxxxx",e.val()),t.setState({userKey:a.key}),void(n=!0)}),n||t.setState({userKey:null})}),console.log(this.state)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("br",null),r.a.createElement("h2",null,"Search friend"),r.a.createElement("input",{type:"text",placeholder:"user email",onChange:this.handleChange,value:this.state.value}),r.a.createElement("button",{onClick:function(){e.props.send(e.state.userKey),e.clearinput()},disabled:!this.state.userKey},"add"))}}]),t}(),C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t="abcdefghijklmnopqrstuvxyzABCDEFGHIJKLMNOPQRSTUVXYZ";return Array.from({length:e}).fill(0).map(function(e){return t[Math.floor(Math.random()*(t.length-1))]}).join("")},O=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var _="待接受",j=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={inviteeInfo:null,friendInfo:null},n.request={sent:"待接受",beComfirm:"待邀請"},n.accept=n.accept.bind(n),n.sendInvitation=n.sendInvitation.bind(n),n.cancelReq=n.cancelReq.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.a.Component),O(t,[{key:"sendInvitation",value:function(e){var t={};t[e]=this.request.beComfirm;var n=Object.assign({},this.props.user.invitation,t),a=Object.assign({},this.props.user,{invitation:n});d(this.props.id,a),d(e+"/invitation/"+this.props.id,this.request.sent)}},{key:"cancelReq",value:function(e){d(e+"/invitation/"+this.props.id,null),d(this.props.id+"/invitation/"+e,null)}},{key:"accept",value:function(e){d(e+"/friends/"+this.props.id,!0),d(this.props.id+"/friends/"+e,!0),d(e+"/invitation/"+this.props.id,null),d(this.props.id+"/invitation/"+e,null)}},{key:"render",value:function(){var e=this,t=this.props.user,n=this.props.allUserData;if(!this.props.id||!t)return r.a.createElement("div",null,r.a.createElement(u.a,{to:"/"},r.a.createElement("button",{className:"btn"},"login page")));var a={friends:"friends",invitation:"invitation"},i=function(i){if(t&&t[a[i]]&&n){var o=t[a[i]];return Object.keys(o).map(function(t){var l=void 0,c=void 0;return i===a.invitation&&(l=o[t]!==e.request.sent,c=!0),r.a.createElement(T,{key:C(),cancel:e.cancelReq,accept:e.accept,itemData:Object.assign({},n[t],{key:t},{canBeFriend:l},{request:o[t]},{canBeCancel:c})})})}},o=i(a.invitation),l=i(a.friends);return r.a.createElement("div",{className:"user"},r.a.createElement("div",null,r.a.createElement(u.a,{to:"/article"},r.a.createElement("button",{className:"btn"}," All articles ")),r.a.createElement(u.a,{to:"/post"},r.a.createElement("button",{className:"btn"}," New post "))),r.a.createElement("div",{className:"userText"},r.a.createElement("div",{className:"name"}," ",this.props.user.name),r.a.createElement("div",{className:"mail"}," mail: ",this.props.user.email)),r.a.createElement("div",null,r.a.createElement(w,{send:this.sendInvitation,email:this.props.email})),r.a.createElement("div",null,r.a.createElement("h2",null,"Invitation list"),r.a.createElement("div",null,o||"No invitation")),r.a.createElement("div",null,r.a.createElement("h2",null,"Friend list"),r.a.createElement("div",null,l||"No friends")))}}]),t}(),T=function(e){var t=e.itemData,n=e.accept,a=e.cancel,i=t.request===_?r.a.createElement("span",{className:"status"},"request sent"):r.a.createElement("span",{className:"status"}," comfirm request "),o=r.a.createElement("button",{onClick:function(){return n(t.key)}},"be friend"),l=r.a.createElement("button",{className:"btn",onClick:function(){return a(t.key)}},"cancel");return r.a.createElement("div",{className:"list-item",key:C()},r.a.createElement("div",{className:"name"}," ",t.name," ",t.canBeCancel&&i," "),r.a.createElement("div",{className:"mail"}," ",t.email," "),t.canBeFriend&&o,t.canBeCancel&&l)},x=(n(2),function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}());var S=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={keyword:""},n.handleChange=n.handleChange.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.a.Component),x(t,[{key:"handleChange",value:function(e){this.setState({keyword:e.currentTarget.value})}},{key:"render",value:function(){var e=this,t=void 0,n=void 0,a=this.props.article;return a&&(n=(n=Object.values(a)).filter(function(t){var n=new RegExp(e.state.keyword,"gi");return t.title.match(n)||t.tag.match(n)||t.author.match(n)})),n&&(t=n.map(function(e){return r.a.createElement("div",{className:"post",key:C()},r.a.createElement("h5",null,e.author," 說"),r.a.createElement("h6",null,e.title),r.a.createElement("div",null,e.content),r.a.createElement("h4",null,r.a.createElement("span",null,e.tag)))})),r.a.createElement("div",null,r.a.createElement(u.a,{to:"/user"}," ",r.a.createElement("button",{className:"btn"}," Profile ")," "),r.a.createElement(u.a,{to:"/post"}," ",r.a.createElement("button",{className:"btn"}," New Post ")," "),r.a.createElement("h2",null,"Articles"),r.a.createElement("div",null,r.a.createElement("input",{type:"text",placeholder:"search some post",onChange:this.handleChange,value:this.state.keyword})),t)}}]),t}(),N=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var P=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={email:"3@g.com",name:""},n.handleName=n.handleName.bind(n),n.handleEmail=n.handleEmail.bind(n),n.login=n.login.bind(n),n.registerUser=n.registerUser.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.a.Component),N(t,[{key:"handleName",value:function(e){this.setState({name:e.currentTarget.value})}},{key:"handleEmail",value:function(e){this.setState({email:e.currentTarget.value})}},{key:"login",value:function(){var e=this;console.log("start login"),m(this.state.email,function(t){console.log(e.state.email),t.forEach(function(t){if(t.key)return console.log("-------",t.key),void e.props.update({currentId:t.key,userData:t.val()})}),console.log("login failed")})}},{key:"registerUser",value:function(){var e=v({email:this.state.email,name:this.state.name,firends:[],invitation:[]});this.setState({name:"",email:""}),this.props.update({currentId:e})}},{key:"render",value:function(){var e=this,t=null,n=!1;return m(this.state.email,function(e){e.forEach(function(e){return e.key&&(n=!0,t=r.a.createElement("h4",null,"Already registered")),e.key})}),r.a.createElement("div",{className:"login"},r.a.createElement("h2",null,"Login / Register"),r.a.createElement("div",null,r.a.createElement("input",{type:"text",onChange:this.handleName,value:this.state.name,placeholder:"name"})),r.a.createElement("div",null,r.a.createElement("input",{type:"text",onChange:this.handleEmail,placeholder:"email",value:this.state.email})),r.a.createElement("div",null,t),r.a.createElement("div",null,r.a.createElement(u.a,{onClick:this.registerUser,to:"/user"},r.a.createElement("button",{disabled:n},"Register")),r.a.createElement(u.a,{to:"/user",onClick:function(){return e.props.login(e.state.email)}},r.a.createElement("button",{disabled:!n},"login"))))}}]),t}(),I=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var F=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={content:"",title:"",tag:""},n.handleChangeTitle=n.handleChangeTitle.bind(n),n.handleChangeContent=n.handleChangeContent.bind(n),n.postToFirebase=n.postToFirebase.bind(n),n.handleChangeTag=n.handleChangeTag.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.a.Component),I(t,[{key:"handleChangeTitle",value:function(e){this.setState({title:e.currentTarget.value})}},{key:"handleChangeTag",value:function(e){this.setState({tag:e.currentTarget.value})}},{key:"handleChangeContent",value:function(e){this.setState({content:e.currentTarget.value})}},{key:"postToFirebase",value:function(e){!function(e){c.a.database().ref("article/").push(e)}(e)}},{key:"render",value:function(){var e=this;if(console.log("------in post area------"),console.log(this.props.id,this.props.user),console.log("------------"),!this.props.id||!this.props.user)return r.a.createElement("div",null,"not login yet");var t=this.props.user&&r.a.createElement("h3",null," ",this.props.user.name," "),n=this.props.user.name?r.a.createElement("div",null,r.a.createElement(u.a,{onClick:function(){var t=(new Date).getTime(),n=Object.assign({},e.state,{authorId:e.props.id},{author:e.props.user.name},{createTime:t});e.postToFirebase(n)},to:"/article"},r.a.createElement("button",null," Post "))):r.a.createElement("p",null,"login before post");return r.a.createElement("div",{className:"postarea"},r.a.createElement("div",null,r.a.createElement(u.a,{to:"/user"},r.a.createElement("button",{className:"btn"}," Profile ")),r.a.createElement(u.a,{to:"/article"},r.a.createElement("button",{className:"btn"}," Article "))),t,r.a.createElement("div",null,r.a.createElement("input",{placeholder:"title",value:this.state.title,onChange:this.handleChangeTitle,type:"text"})),r.a.createElement("div",null,r.a.createElement("input",{placeholder:"tag",value:this.state.tag,onChange:this.handleChangeTag,type:"text"})),r.a.createElement("div",null,r.a.createElement("input",{row:"10",cols:"10",value:this.state.content,onChange:this.handleChangeContent,type:"textarea"})),r.a.createElement("div",{className:"postBtn"},n))}}]),t}(),D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},R=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var q=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={email:null,article:null,allUserData:null,currentUser:null,userData:{email:"",name:"",friends:null,invitation:null},currentId:null},h(),n.fetchFromFirebase=n.fetchFromFirebase.bind(n),n.registerEvent=n.registerEvent.bind(n),n.logout=n.logout.bind(n),n.updateState=n.updateState.bind(n),n.login=n.login.bind(n),n.fetchFromFirebase(),n.registerEvent(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.a.Component),R(t,[{key:"logout",value:function(){this.setState({currentId:null})}},{key:"updateState",value:function(e){this.setState(e)}},{key:"login",value:function(e){var t=this;console.log("start login"),m(e,function(n){console.log(e),n.forEach(function(e){if(e.key)return console.log("-------",e.key),void t.setState({currentId:e.key,userData:e.val()})}),console.log("login failed")})}},{key:"fetchFromFirebase",value:function(){var e=this;E("email").then(function(t){return e.setState({email:t.val()})}),E("article").then(function(t){return e.setState({article:t.val()})})}},{key:"registerEvent",value:function(){var e=this;y(function(t){return e.setState({allUserData:t.val()})}),g(function(t){return e.setState({article:t.val()})})}},{key:"render",value:function(){var e=this;console.log("---------------"),console.log(this.state),console.log("---------------");var t=this.state.currentId?r.a.createElement(u.a,{onClick:this.logout,to:"/"},r.a.createElement("button",null,"logout")):null;return r.a.createElement("div",null,r.a.createElement(s.a,null,r.a.createElement("div",null,t,r.a.createElement(f.a,null,r.a.createElement(p.a,{path:"/",exact:!0,render:function(t){return r.a.createElement(P,D({},t,{login:e.login}))}}),r.a.createElement(p.a,{exact:!0,path:"/user",render:function(){return r.a.createElement(j,{allUserData:e.state.allUserData,user:e.state.userData,id:e.state.currentId,email:e.state.email,article:e.state.article})}}),r.a.createElement(p.a,{path:"/post",render:function(){return r.a.createElement(F,{id:e.state.currentId,user:e.state.userData})}}),r.a.createElement(p.a,{path:"/article",exact:!0,render:function(t){return r.a.createElement(S,D({},t,{article:e.state.article,id:e.state.currentId,user:e.state.userData}))}})))))}}]),t}();o.a.render(r.a.createElement(q,null),document.getElementById("main"))}},[[47,2,1]]]);
//# sourceMappingURL=main.bc9e.js.map